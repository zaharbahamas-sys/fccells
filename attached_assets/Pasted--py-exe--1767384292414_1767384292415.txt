Ù„Ù„Ø£Ø³Ù Ø¨ØµÙØªÙŠ Ù†Ù…ÙˆØ°Ø¬ Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ù†ØµÙŠØŒ Ù„Ø§ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ø¥Ø±Ø³Ø§Ù„ Ù…Ù„ÙØ§Øª (Ù…Ø«Ù„ `.py` Ø£Ùˆ `.exe`) Ø¨Ø´ÙƒÙ„ Ù…Ø¨Ø§Ø´Ø± Ø¹Ø¨Ø± Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ù„Ù„ØªØ­Ù…ÙŠÙ„.

ÙˆÙ„ÙƒÙ†ØŒ **Ø§Ù„Ø­Ù„ Ø¨Ø³ÙŠØ· Ø¬Ø¯Ø§Ù‹**. Ù„Ù‚Ø¯ Ù‚Ù…Øª Ø¨Ø¯Ù…Ø¬ **Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù‡Ù†Ø¯Ø³ÙŠØ© Ø§Ù„ÙƒØ§Ù…Ù„Ø© (Real-World Engineering Edition)** Ø§Ù„ØªÙŠ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ (Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„ÙØ§Ù‚Ø¯ØŒ Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ù…ÙˆÙ„Ø¯ ÙˆØ§Ù„Ø³Ø±Ù‚Ø§ØªØŒ ÙˆØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ±) ÙÙŠ ÙƒÙƒØªÙ„Ø© Ø¨Ø±Ù…Ø¬ÙŠØ© ÙˆØ§Ø­Ø¯Ø© Ø£Ø¯Ù†Ø§Ù‡.

**Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…:**

1. Ù‚Ù… Ø¨Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù Ù†ØµÙŠ Ø¬Ø¯ÙŠØ¯ Ø¹Ù„Ù‰ Ø¬Ù‡Ø§Ø²Ùƒ ÙˆØ³Ù…Ù‘Ù‡ `main.py`.
2. Ø§Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯ Ø£Ø¯Ù†Ø§Ù‡ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ ÙˆØ§Ù„ØµÙ‚Ù‡ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ù„Ù.
3. Ø´ØºÙ„Ù‡ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø£Ù…Ø±: `streamlit run main.py`.

Ø¥Ù„ÙŠÙƒ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„ÙƒØ§Ù…Ù„ (Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©):

```python
import streamlit as st
import pandas as pd
import graphviz
from datetime import datetime

# --- 1. Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØµÙØ­Ø© ---
st.set_page_config(page_title="EcoPower Pro: DG vs FC", layout="wide", page_icon="âš™ï¸")

col_h1, col_h2 = st.columns([3, 1])
with col_h1:
    st.title("âš™ï¸ EcoPower Engineering Tool")
    st.markdown("**Techno-Economic Analysis: Diesel Gen vs. Fuel Cell**")
with col_h2:
    st.write(f"ğŸ“… Date: {datetime.now().strftime('%Y-%m-%d')}")
    st.info("Mode: Real-World Engineering")

st.markdown("---")

# --- 2. ØªØ¹Ø±ÙŠÙ Ø§Ù„ÙƒÙ„Ø§Ø³Ø§Øª (Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©) ---
class FuelCell:
    def __init__(self, name, technology, efficiency, min_p, max_p, fuel_type, lhv, parasitic_loss, source):
        self.name = name
        self.technology = technology
        self.efficiency = efficiency      # Electrical Efficiency
        self.min_power = min_p
        self.max_power = max_p
        self.fuel_type = fuel_type
        self.lhv = lhv                    # kWh/kg
        self.parasitic_loss = parasitic_loss # Internal consumption (Fans/Pumps)
        self.source = source

# Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ballard, Plug, etc.)
inventory = [
    FuelCell("Ballard FCgen-H2PM", "PEMFC", 0.50, 1.0, 5.0, "Hydrogen", 33.3, 0.08, "Ballard Datasheet"), 
    FuelCell("Bloom Energy Server", "SOFC", 0.60, 50.0, 200.0, "Nat Gas", 13.9, 0.12, "Bloom Energy"),
    FuelCell("SFC EFOY Pro", "DMFC", 0.35, 0.05, 0.5, "Methanol", 5.5, 0.05, "SFC Energy"),
]

# --- 3. Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª (Sidebar) ---
st.sidebar.header("1. Site Constraints")
lat = st.sidebar.number_input("Latitude", 15.50, format="%.2f")
lon = st.sidebar.number_input("Longitude", 32.50, format="%.2f")
temp = st.sidebar.number_input("Max Site Temp (Â°C)", value=42, help="ÙŠØ¤Ø«Ø± Ø¹Ù„Ù‰ ÙƒÙØ§Ø¡Ø© Ø§Ù„Ø®Ù„ÙŠØ©")
altitude = st.sidebar.number_input("Altitude (m)", value=400)

st.sidebar.header("2. Load Profile")
load_kw_site = st.sidebar.number_input("Critical IT Load (kW)", value=4.0)

# Ø­Ø³Ø§Ø¨ Ù…ÙØ§Ù‚ÙŠØ¯ Ø§Ù„Ø­Ø±Ø§Ø±Ø© (Derating)
derating_factor = 1.0
if temp > 35:
    derating_factor -= (temp - 35) * 0.015
    
# Ø§Ù„Ø­Ù…Ù„ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ ØªÙˆÙ„ÙŠØ¯Ù‡ (Ø´Ø§Ù…Ù„ ØªØ¹ÙˆÙŠØ¶ Ø§Ù„Ø­Ø±Ø§Ø±Ø©)
required_gross_power = load_kw_site / derating_factor

st.sidebar.header("3. Existing DG Info")
dg_capacity_kva = st.sidebar.number_input("Generator Capacity (kVA)", value=20.0)
dg_fuel_price = st.sidebar.number_input("Diesel Price ($/Liter)", value=1.2)
pilferage_factor = st.sidebar.slider("Theft/Loss Factor %", 0, 30, 10, help="Ù†Ø³Ø¨Ø© Ø³Ø±Ù‚Ø© Ø§Ù„ÙˆÙ‚ÙˆØ¯ Ø£Ùˆ Ø§Ù„ÙØ§Ù‚Ø¯ Ø§Ù„Ù„ÙˆØ¬Ø³ØªÙŠ")

st.sidebar.header("4. Fuel Cell Inputs")
h2_price = st.sidebar.number_input("Hydrogen Price ($/kg)", value=15.0)

# --- 4. Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø®Ù„ÙŠØ© Ø§Ù„Ø£Ù†Ø³Ø¨ ---
selected_fc = None
valid_cells = [c for c in inventory if c.min_power <= required_gross_power <= c.max_power]
if valid_cells:
    selected_fc = sorted(valid_cells, key=lambda x: x.efficiency, reverse=True)[0]

# --- 5. Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ---
tabs = st.tabs(["âš–ï¸ DG vs FC Comparison", "ğŸ“ Engineering Sizing", "ğŸ”‹ Hybrid Battery", "ğŸ“¦ Logistics", "ğŸ“„ Report"])

# === TAB 1: Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ù…Ø§Ù„ÙŠØ© ÙˆØ§Ù„ØªØ´ØºÙŠÙ„ÙŠØ© ===
with tabs[0]:
    st.header("Comparative Analysis (Real-World Scenario)")
    
    col_c1, col_c2 = st.columns(2)
    
    # Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù…ÙˆÙ„Ø¯ (Ø§Ù„ÙˆØ§Ù‚Ø¹ Ø§Ù„Ù…Ø¤Ù„Ù…)
    dg_capacity_kw = dg_capacity_kva * 0.8
    load_factor = (load_kw_site / dg_capacity_kw) * 100
    
    # Ù…Ø¹Ø§Ø¯Ù„Ø© Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ø§Ù„Ø¯ÙŠØ²Ù„ ØºÙŠØ± Ø§Ù„Ø®Ø·ÙŠØ© (Non-linear consumption)
    # Fuel = 0.07*Rated + 0.24*Load
    fuel_hourly_engine = (0.07 * dg_capacity_kw) + (0.24 * load_kw_site)
    fuel_hourly_billed = fuel_hourly_engine * (1 + pilferage_factor/100) # Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ø±Ù‚Ø©
    
    with col_c1:
        st.subheader("ğŸ”´ Existing Diesel Generator")
        st.metric("Load Factor", f"{int(load_factor)}%", delta="Low Efficiency Risk" if load_factor < 30 else "OK", delta_color="inverse")
        st.write(f"Engine Consumption: **{round(fuel_hourly_engine, 2)} L/hr**")
        st.write(f"Theft/Loss Overhead: **+{round(fuel_hourly_billed - fuel_hourly_engine, 2)} L/hr**")
        
        daily_cost_dg = fuel_hourly_billed * 24 * dg_fuel_price
        st.error(f"Daily OPEX: ${round(daily_cost_dg, 2)}")

    # Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø®Ù„ÙŠØ© (Ø§Ù„Ø­Ù„ Ø§Ù„Ù…Ù‚ØªØ±Ø­)
    with col_c2:
        st.subheader("ğŸŸ¢ Proposed Fuel Cell")
        if selected_fc:
            # Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ø§Ù„Ù‡ÙŠØ¯Ø±ÙˆØ¬ÙŠÙ† = Ø§Ù„Ù‚Ø¯Ø±Ø© Ø§Ù„ÙƒÙ„ÙŠØ© / Ø§Ù„ÙƒÙØ§Ø¡Ø© / Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø­Ø±Ø§Ø±ÙŠØ©
            h2_hourly = required_gross_power / selected_fc.efficiency / selected_fc.lhv
            daily_cost_fc = h2_hourly * 24 * h2_price
            
            st.metric("System Efficiency", f"{int(selected_fc.efficiency*100)}%")
            st.write(f"Fuel Consumption: **{round(h2_hourly, 2)} kg/hr**")
            st.write("Theft Risk: **0% (Cannot be siphoned)**")
            
            st.success(f"Daily OPEX: ${round(daily_cost_fc, 2)}")
            
            saving = daily_cost_dg - daily_cost_fc
            if saving > 0:
                st.metric("Net Daily Savings", f"${round(saving, 2)}", "Positive ROI")
            else:
                st.metric("Additional Cost", f"${abs(round(saving, 2))}", "Premium for Green Energy", delta_color="inverse")

    st.markdown("---")
    st.subheader("ğŸ“‰ Cumulative Cost (1 Year)")
    
    # Ø±Ø³Ù… Ø¨ÙŠØ§Ù†ÙŠ Ù„Ù„ØªÙƒÙ„ÙØ© Ø§Ù„ØªØ±Ø§ÙƒÙ…ÙŠØ©
    days = range(1, 366)
    cost_dg = [d * daily_cost_dg for d in days]
    cost_fc = [d * daily_cost_fc for d in days]
    
    df_chart = pd.DataFrame({"Diesel Gen (Current)": cost_dg, "Fuel Cell (Proposed)": cost_fc})
    st.line_chart(df_chart)

# === TAB 2: Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ù‡Ù†Ø¯Ø³ÙŠ ===
with tabs[1]:
    st.header("Sizing & Losses Analysis")
    if selected_fc:
        # Ø­Ø³Ø§Ø¨ Ø§Ù„ÙÙ‚Ø¯ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ
        parasitic_load = required_gross_power * selected_fc.parasitic_loss
        net_output = required_gross_power - parasitic_load
        
        c1, c2, c3 = st.columns(3)
        c1.metric("Gross Power Generated", f"{round(required_gross_power, 2)} kW")
        c2.metric("Parasitic Loss (Fans)", f"{round(parasitic_load, 2)} kW", f"-{int(selected_fc.parasitic_loss*100)}%")
        c3.metric("Temp Derating Loss", f"{int((1-derating_factor)*100)}%", f"at {temp}Â°C", delta_color="inverse")
        
        st.graphviz_chart(f"""
        digraph G {{
            rankdir=LR;
            node [shape=box style=filled];
            Stack [label="FC Stack\\n{round(required_gross_power, 2)} kW" color=lightblue];
            Aux [label="Auxiliaries\\n{round(parasitic_load, 2)} kW" color="#ffcccb"];
            Load [label="Site Load\\n{load_kw_site} kW" color=lightgreen];
            
            Stack -> Aux [style=dashed label="Loss"];
            Stack -> Load [label="Net Power"];
        }}
        """)

# === TAB 3: Ø§Ù„Ø¨Ø·Ø§Ø±ÙŠØ§Øª ===
with tabs[2]:
    st.header("Hybrid Battery Buffer Calculation")
    st.write("Required to cover startup time and peak loads.")
    
    batt_hours = st.slider("Buffer Time (Hours)", 1, 8, 4)
    sys_voltage = 48
    dod = 0.8
    
    required_ah = (load_kw_site * 1000 * batt_hours) / (sys_voltage * dod)
    
    st.info(f"ğŸ”‹ Minimum Battery Capacity: **{int(required_ah)} Ah** @ 48V")
    st.write(f"Configuration Recommendation: {int(required_ah/150)+1} Strings of 150Ah blocks.")

# === TAB 4: Ø§Ù„Ù„ÙˆØ¬Ø³ØªÙŠØ§Øª ===
with tabs[3]:
    st.header("Logistics Planning")
    if selected_fc and selected_fc.fuel_type == "Hydrogen":
        days_autonomy = st.number_input("Refueling Cycle (Days)", 1, 30, 7)
        total_h2 = (required_gross_power / selected_fc.efficiency / selected_fc.lhv) * 24 * days_autonomy
        
        cylinders = int(total_h2 / 0.89) + 1
        racks = int(cylinders / 12) + 1
        
        st.warning(f"ğŸ“¦ For {days_autonomy} days autonomy:")
        st.metric("Cylinders (50L @ 200bar)", f"{cylinders} Units")
        st.metric("Bundles (12-Pack)", f"{racks} Bundles")

# === TAB 5: Ø§Ù„ØªÙ‚Ø±ÙŠØ± ===
with tabs[4]:
    st.header("ğŸ“„ Export Engineering Report")
    
    if selected_fc:
        report_text = f"""
        ========================================
        ENGINEERING STUDY REPORT: DG vs FC
        ========================================
        Date: {datetime.now().strftime('%Y-%m-%d')}
        Location: Lat {lat}, Lon {lon}
        
        1. SITE ANALYSIS
        ----------------
        Load: {load_kw_site} kW
        Max Temp: {temp} C (Derating applied: {int((1-derating_factor)*100)}%)
        
        2. EXISTING SITUATION (DIESEL)
        ------------------------------
        Generator: {dg_capacity_kva} kVA
        Load Factor: {int(load_factor)}% (Inefficient Range)
        Fuel Consumption (Real + Theft): {round(fuel_hourly_billed, 2)} L/hr
        Daily OPEX: ${round(daily_cost_dg, 2)}
        
        3. PROPOSED SOLUTION (FUEL CELL)
        --------------------------------
        Model: {selected_fc.name}
        Gross Power: {round(required_gross_power, 2)} kW
        Parasitic Loss: {int(selected_fc.parasitic_loss*100)}%
        Daily OPEX: ${round(daily_cost_fc, 2)}
        
        4. FINANCIAL VERDICT
        --------------------
        Daily Savings: ${round(daily_cost_dg - daily_cost_fc, 2)}
        Theft Risk Eliminated: Yes
        
        ========================================
        Generated by EcoPower Engineering Tool
        """
        
        st.download_button("ğŸ“¥ Download Report (.txt)", report_text, file_name="Engineering_Report.txt")

```